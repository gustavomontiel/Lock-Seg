<app-header [verTitulo]="true"></app-header>
<ion-content>
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <ion-item *ngIf="mostrarProblemas || mostrarAlarma" >
    <ion-label>
      <h3>Registro de Problemas</h3>
      <br>
      <p  class="problemas" *ngIf="currentStatus && currentStatus.regProblemas[0] == 1">
        <ion-icon class="iconoProblemas" color="danger"  name="wifi-outline" size="large"></ion-icon>
        Hay fallo de Red.
      </p>
      <p class="problemas" *ngIf="currentStatus && currentStatus.regProblemas[1] == 1">
        <ion-icon class="iconoProblemas"  color="danger"  name="battery-dead-outline" size="large"></ion-icon>
        El panel tiene batería baja.
      </p>
      <p class="problemas" *ngIf="currentStatus && currentStatus.regProblemas[4] == 1">
        <ion-icon class="iconoProblemas"  color="danger"  name="flash-off-outline" size="large"></ion-icon>
        Hay un fallo en la alimentación auxiliar del panel.
      </p>
      <p class="problemas"  *ngIf="mostrarAlarma">
        <ion-icon class="iconoProblemas"  color="warning"  name="warning" size="large"></ion-icon>
        ¡Alarma activada!
      </p>
    </ion-label>
  </ion-item>

  <ion-card>


    <ion-card-header>
      <ion-segment [(ngModel)]="selectedPartition">
        <ion-segment-button value=0 *ngIf="partiDisp >= 1">
          Part.1
        </ion-segment-button >
        <ion-segment-button value=1 *ngIf="partiDisp >= 2">
          Part.2
        </ion-segment-button>
        <ion-segment-button value=2 *ngIf="partiDisp >= 3">
          Part.3
        </ion-segment-button>
        <ion-segment-button value=3 *ngIf="partiDisp >= 4">
          Part.4
        </ion-segment-button>
      </ion-segment>
      <br>
    </ion-card-header>

    <!-- <div>
     <ion-avatar slot="start">
       <ion-icon name="apps-outline" size="large"></ion-icon>
     </ion-avatar>
     <ion-label *ngIf="currentStatus">
       <ion-text color="">
       <ion-text color="{{ panel.success ? (panel.triggered ? 'danger' : '') : 'danger'}}">
         <h3>Panel: {{ this.numeroSistema }} {{ currentStatus ? (panel.triggered ?
           'DISPARADA!' : '') : '(NO ENCONTRADO)'}} </h3>
         <p>{{ panel.updatedAt | date: 'dd/MM/yyyy HH:mm' }}</p>
       </ion-text>
     </ion-label>
     <ion-avatar slot="end" *ngIf="currentStatus">
       <ion-icon *ngIf="currentStatus.triggered" name="volume-high-outline" color="danger" size="large"></ion-icon>
     </ion-avatar>
   </div> -->



    <ion-card-content>
      <ion-item>
        <ion-row *ngIf="currentStatus">
          <ion-col class="col_panel">
            <button class="bpanel">
              <ion-icon color="success" *ngIf="currentStatus && currentStatus.estadoParticiones[selectedPartition] == 1" name="shield-checkmark-outline"
                size="large"></ion-icon>
              <!-- <ion-icon color="warning" *ngIf="currentStatus && currentStatus.estadoParticiones[selectedPartition -1] == 0" name="shield-half-outline"
                size="large"></ion-icon> -->
              <ion-icon color="danger" name="close-outline" *ngIf="currentStatus && currentStatus.estadoParticiones[selectedPartition] == 0" size="large">
              </ion-icon>

              <div class="plabel"> Partición {{ currentStatus ? (currentStatus.estadoParticiones[selectedPartition] == 1 ? 'Armada' : 'No Armada') : 'Sin conexión'}}</div>
            </button>
          </ion-col>
          <ion-col class="">
            <button class="bpanel">
              <ion-icon name="alert-circle-outline" size="large" color="warning"></ion-icon>
              <div class="plabel">{{ currentStatus.zonaAbierta ? sumaArray(currentStatus.zonaAbierta,0,currentStatus.zonaAbierta.length) : '' }} Zonas Abiertas</div>
            </button>
          </ion-col>
          <ion-col class="">
            <button class="bpanel">
              <ion-icon name="close-circle-outline" size="large"  color="danger"></ion-icon>
              <div class="plabel">{{ currentStatus.zonaInhibida ? sumaArray(currentStatus.zonaInhibida,0,currentStatus.zonaInhibida.length ) : '' }} Zonas Excluidas
              </div>
            </button>
          </ion-col>

        </ion-row>
      </ion-item>
    </ion-card-content>

    <ion-footer>
      <ion-button expand="block"  *ngIf="currentStatus && currentStatus.estadoParticiones[selectedPartition] == 1"
        (click)="desarmarPanel()">Desarmar Partición</ion-button>
      <ion-button expand="block" [disabled]="currentStatus.particionesListas[selectedPartition] == 0" *ngIf="currentStatus && currentStatus.estadoParticiones[selectedPartition] == 0"
        (click)="armarPanel()">Armar Partición</ion-button>
    </ion-footer>

    <ion-list *ngIf="currentStatus">
      <ion-list-header>
        Zonas:
      </ion-list-header>
      <!-- Zonas cableadas -->
      <div *ngFor="let zona of currentStatus.zonaAlarma; let i = index">
        <ion-item *ngIf="i+1 <= zonasCable">
          <ion-avatar slot="start">
            <ion-icon color="success" *ngIf="currentStatus.zonaAbierta[i] == 0" name="checkmark-circle-outline" size="large"></ion-icon>
            <ion-icon color="danger" *ngIf="currentStatus.zonaAbierta[i] == 1" name="alert-circle-outline" size="large"></ion-icon>
          </ion-avatar>
          <ion-label>
            <ion-text>
              <h3>Zona N°: <b>{{i+1}}</b> </h3>
            </ion-text>
          </ion-label>
          <ion-button *ngIf="currentStatus.zonaInhibida[i] == 0" (click)="excluirZona(i)"
            color="danger">Excluir</ion-button>
          <ion-button *ngIf="currentStatus.zonaInhibida[i] == 1" (click)="incluirZona(i)"
            color="success">Incluir</ion-button>
        </ion-item>
      </div>
      <!-- Zonas Inhalambricas -->
      <div *ngFor="let zona of currentStatus.zonaAlarma; let i = index">
        <ion-item *ngIf="i+1 <= zonasInha">
          <ion-avatar slot="start">
            <ion-icon color="success" *ngIf="currentStatus.zonaAbierta[i+wirelessZonesStartsFrom] == 0" name="checkmark-circle-outline" size="large"></ion-icon>
            <ion-icon color="danger" *ngIf="currentStatus.zonaAbierta[i+wirelessZonesStartsFrom] == 1" name="alert-circle-outline" size="large"></ion-icon>
          </ion-avatar>
          <ion-label>
            <ion-text>
              <h3>Zona N°: <b>{{i+1+wirelessZonesStartsFrom}}</b> </h3>
            </ion-text>
          </ion-label>
          <ion-button *ngIf="currentStatus.zonaInhibida[i+wirelessZonesStartsFrom] == 0" (click)="excluirZona(i+wirelessZonesStartsFrom)"
            color="danger">Excluir</ion-button>
          <ion-button *ngIf="currentStatus.zonaInhibida[i+wirelessZonesStartsFrom] == 1" (click)="incluirZona(i+wirelessZonesStartsFrom)"
            color="success">Incluir</ion-button>
        </ion-item>
      </div>

    </ion-list>

  </ion-card>

</ion-content>
